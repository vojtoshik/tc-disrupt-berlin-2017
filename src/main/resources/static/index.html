<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" crossorigin="">
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js" crossorigin=""></script>
    <script src="https://releases.route360.net/r360-js/latest.js"></script>


    <!-- Load Esri Leaflet locally, after cloning this repository -->
    <script src="https://unpkg.com/esri-leaflet@2.1.1"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js"></script>

    <style>
      html, body, #map {
        margin:0; padding:0;  width : 100%; height : 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
        var map = L.map('map').setView([52.31, 13.24], 10);
        L.esri.basemapLayer("Gray").addTo(map);

        var addressPoints = [
                [52.61, 13.84, 100], // lat, lng, intensity
                [52.33, 13.24, 90],
                [52.31, 13.35, 90],
                [52.31, 13.46, 90],
                [52.31, 13.57, 90],
                [52.31, 13.68, 90],
                [52.33, 13.79, 90],
                [52.61, 13.30, 82.5]];
        var heat = L.heatLayer(addressPoints,{radius: 25}).addTo(map);


        //изохрона
        var latlon = [52.63, 13.281];


         var markerA = L.marker((latlon),{ draggable: true }).addTo(map);
         var polygonLayer = r360.leafletPolygonLayer({ inverse: true }).addTo(map);
         polygonLayer.setColors([{
              'time': 600,
              'opacity' : 0.5
            }, {
              'time': 1200,
               'opacity' : 0.2
            }, ]);
         var showPolygons = function(rezoom) {
             var travelOptions = r360.travelOptions();
                travelOptions.setServiceKey('3WQ8V9LAR8PIAE6T5LRZMBT');
                travelOptions.addSource(markerA);
                travelOptions.setTravelTimes([600, 1200]);
                travelOptions.setTravelType('transit');
                travelOptions.setServiceUrl('https://service.route360.net/germany/');

            r360.PolygonService.getTravelTimePolygons(travelOptions, function(polygons){
                polygonLayer.clearAndAddLayers(polygons, rezoom || false);
            });
        };
        showPolygons(true);
        markerA.on('dragend', function(){ showPolygons(true); });

    </script>
  </body>
</html>